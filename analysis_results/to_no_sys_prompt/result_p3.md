# TL;DR

**4-1 が最も指示と品質を両立し、4o はフォーマットは良いがサイクル検出を欠く。o3／o4-mini-high は堅実、o4-mini は最小実装だが余計なデモ付きで僅差最下位。**

---

## 俯瞰 ― 全体傾向

* **全モデルが正しくトポロジカルソートを実装し、計算量 \$O(V+E)\$ を提示**。
* **フォーマット遵守度**は 4-1 → 4o → o3 → o4-mini-high → o4-mini の順。P3 プロンプトで要求された「1. コードブロック」「2. 計算量 1 行」の**番号列挙**まで完全に守ったのは 4-1 と 4o のみ。
* **アルゴリズム健全性**では DFS ベースの 4o が唯一サイクル検出を行わず、信頼性で一歩劣る。

> **ポイント**
> 今回の P3 はシンプルな技術実装タスクのため、\*\*差は「指示への細部追従」と「エッジケース処理」\*\*に表れやすい。

---

## 詳細

### 1. 指示追従性（フォーマット）

| モデル          | 番号列挙 1 + 2 | コードブロック | 計算量 1 行 | 余計な要素       |
| ------------ | ---------- | ------- | ------- | ----------- |
| 4-1          | ✅          | ✅       | ✅       | なし          |
| 4o           | ✅          | ✅       | ✅       | なし          |
| o3           | ❌（番号なし）    | ✅       | ✅       | なし          |
| o4-mini-high | ❌          | ✅       | ✅       | なし          |
| o4-mini      | ❌          | ✅       | ✅       | **例示コード**挿入 |

### 2. アルゴリズム健全性・堅牢性

| モデル          | 手法   | サイクル検出           | 型ヒント／Docstring |
| ------------ | ---- | ---------------- | -------------- |
| 4-1          | Kahn | raise ValueError | ✖（簡潔）          |
| 4o           | DFS  | **なし**           | ✖              |
| o3           | Kahn | raise ValueError | ✔              |
| o4-mini-high | Kahn | raise ValueError | ✖              |
| o4-mini      | Kahn | raise ValueError | ✖              |

### 3. コード品質・可読性

* **4-1**: deque・辞書内包で最短かつ明快、解説 1 行も太字で強調。
* **o3**: Docstring と `typing` で API を自説明。解読性が高い。
* **4o**: DFS 実装はシンプルで速いが、サイクル有無が分からないため実務向きでない。
* **o4-mini-high / o4-mini**: コードは短いがコメント最小。o4-mini はサンプル実行をコード内に入れ込み、プロンプト外要素が混在。

### 4. 内省

1. **評価軸の重み**

   * 指示遵守と安全性（サイクル検出）の両立を最重視――現行結論は妥当。
2. **4o の位置付け**

   * フォーマット満点でもロバスト性が劣るため 2 位に据えた。
3. **小型モデルの余計な出力**

   * トークン節約のはずがデモコードを足す例（o4-mini）。プロンプトの“余分削除”指示を強めると改善余地。

---

## 要点テーブル（5 段階主観評価）

| モデル          | 指示遵守  | 安全性   | 可読性   | 総合     |
| ------------ | ----- | ----- | ----- | ------ |
| 4-1          | ★★★★★ | ★★★★★ | ★★★★☆ | **最良** |
| 4o           | ★★★★★ | ★★☆☆☆ | ★★★★☆ | 準最良    |
| o3           | ★★★★☆ | ★★★★★ | ★★★★☆ | 中庸＋    |
| o4-mini-high | ★★★☆☆ | ★★★★★ | ★★★☆☆ | 中庸     |
| o4-mini      | ★★★☆☆ | ★★★★★ | ★★★☆☆ | 最小限    |

> **ポイント**
> 「4o」と「o4-mini(-high)」が別系列であることを踏まえても、**中～大型モデルほどフォーマット遵守の自由度が高く、小型モデルは“余計なデモ追加”で指示から逸脱しやすい**傾向が再確認できた。

---

## Related Topics

* Kahn vs DFS トポロジカルソートの利点と限界
* LLM におけるコードセーフティ評価（例外処理・境界条件）
* プロンプト設計で「余計な例示」を防ぐテクニック
