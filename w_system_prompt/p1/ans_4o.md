# 結論 / TL;DR

オブジェクトストレージの整合性モデルは「いつ・どのようにデータが一貫した状態になるか」を定義し、可用性や性能に直結する。

---

## 全体像

### なにを扱うか

オブジェクトストレージ（例: Amazon S3, Google Cloud Storage）は、**非構造データを保存・配信するためのスケーラブルなストレージ**で、整合性モデルはその**データの読み書きの一貫性の保証レベル**を示す。

### なぜ重要か

整合性モデルによって、次のようなシステム設計の判断に影響が出る：

* データ更新後に即座に反映されるかどうか（ユーザー体験・デバッグ効率）
* 並列アクセス時の予期せぬ挙動の抑制（バグ回避）
* 高速配信とのトレードオフ（性能 vs. 信頼性）

---

## 詳細

### 整合性モデルの種類

#### 1. 強い整合性（Strong Consistency）

**何をするか**: 読み取り時に必ず最新の書き込み結果を返す。
**なぜ重要か**: 同時アクセスや即時反映が必要なシナリオで必須。
**どのように使うか**: Amazon S3（現在は標準）、GCP など一部対応。

> **ポイント**: キャッシュやCDNを使うと、強整合性が崩れる場合がある。

#### 2. 最終的整合性（Eventual Consistency）

**何をするか**: 書き込み後、しばらくしてから更新が伝搬される。
**なぜ重要か**: パフォーマンスを優先し、トラフィックの多いアプリに最適。
**どのように使うか**: 一部のS3操作（リスト表示など）や古いオブジェクトストレージ。

> **ポイント**: 更新直後に古いデータが返る可能性あり。リトライ戦略が有効。

#### 3. 読み取り後の整合性（Read-after-write Consistency）

**何をするか**: オブジェクト作成後の最初の読み取りは最新状態を保証。
**なぜ重要か**: 新規データの即時確認が可能で、ユーザー投稿アプリに適する。
**どのように使うか**: S3の新しいオブジェクト作成時など。

> **ポイント**: 更新（overwrite）には対応せず、新規作成時のみ強整合性を保証。

---

## まとめ

整合性モデルの選択は、**性能・コスト・一貫性のバランス**を取るための設計指針であり、要件に応じて適切に選ぶ必要がある。

---

## 整合性モード・整合速度・事例

| 整合性モード           | 整合速度   | 事例                              |
| ---------------- | ------ | ------------------------------- |
| 強い整合性（Strong）    | 即時     | Amazon S3（2020以降）、GCP Storage   |
| 最終的整合性（Eventual） | 数秒〜数十秒 | S3バケットリスト表示、旧Azure Blob Storage |
| 読み取り後の整合性（RAW）   | 初回即時   | S3新規オブジェクト作成後の読み取り              |

---

## Related Topics

* CAP定理とそのクラウド適用
* 分散ストレージにおけるレプリケーション
* クラウド設計パターン（CQRS, イベントソーシング）
