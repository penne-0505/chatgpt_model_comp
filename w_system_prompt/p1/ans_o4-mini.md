# 結論 / TL;DR

オブジェクトストレージの整合性モデルは「強い整合性」「リードアフタライト整合性」「最終的整合性」の３種類に大別され、用途や性能要件に応じて選択される。

## 全体像

オブジェクトストレージは、分散環境下で大量のデータを扱うため、整合性モデルによって読み書きのタイミングや反映保証を定義しています。主なモデルは以下の３つです。

* **強い整合性**：書き込み完了後、即時に全ノードでデータが反映される。
* **リードアフタライト整合性**：新規オブジェクト作成時のみ、書き込み後の即時読み取りが保証される。
* **最終的整合性**：書き込み後、一定時間内に全ノードで整合状態になることを保証し、遅延が生じる可能性がある。

これらは「何をするか」「なぜ必要か」「どのように実現するか」の観点で選択されます。

## 詳細

### 強い整合性

1. **何をするのか**

   * 書き込み完了後、すべてのクライアントが同じ最新データを即座に読み取れる状態にする。
2. **なぜ重要か**

   * 金融取引やユーザー設定など、即時性と正確性が求められるアプリケーションに必須。
3. **どのように行うか**

   * 分散トランザクションやリーダー選出による同期レプリケーションを採用し、書き込み時に全レプリカと合意（Quorum）を取る。

> **ポイント**: 同期処理のためレイテンシが高くなりやすい。

### リードアフタライト整合性

1. **何をするのか**

   * 新規オブジェクト作成時のみ、書き込み直後の読み取りで最新データが返る。
2. **なぜ重要か**

   * 大半は追加操作で更新頻度が低いログ保存やメディアアップロードなどに適用。
3. **どのように行うか**

   * 新規PUT時は書き込みエンドポイント直結で応答し、その後バックグラウンドで他レプリカに同期。

> **ポイント**: 上書き・削除時は最終的整合性となる場合が多い。

### 最終的整合性

1. **何をするのか**

   * 書き込み完了後、しばらくすると全ノードのデータが一致する。
2. **なぜ重要か**

   * 大規模分散を優先し、一貫性より可用性／スケーラビリティを重視する場合に有効。
3. **どのように行うか**

   * 非同期レプリケーションで高速応答を実現し、同期は遅延許容で行われる。

> **ポイント**: レプリケーション遅延により一時的に古いデータが返る可能性がある。

## まとめ

用途に合わせて整合性モデルを選ぶことで、性能（レイテンシ・スループット）と一貫性保証のトレードオフを最適化できます。以下の表でモード別の特徴と代表例をまとめました。

| 整合性モード       | 整合速度            | 事例                                      |
| ------------ | --------------- | --------------------------------------- |
| 強い整合性        | 即時（書込完了後直ちに反映）  | Google Cloud Storage、Azure Blob Storage |
| リードアフタライト整合性 | 書込後直後（新規オブジェクト） | Amazon S3（新規PUT時の読み取り保証）                |
| 最終的整合性       | 遅延（数秒～数分の同期遅延）  | Amazon S3（上書き・DELETE）、OpenStack Swift   |

# Related Topics

* 分散トランザクションのアルゴリズム（Paxos/Raft）
* キャッシュ一貫性（Cache Coherence）
* マイクロサービスアーキテクチャにおけるデータ整合性戦略
